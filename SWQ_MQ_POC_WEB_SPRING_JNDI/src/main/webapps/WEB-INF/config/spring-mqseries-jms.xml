<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:util="http://www.springframework.org/schema/util" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:jee="http://www.springframework.org/schema/jee" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 	http://www.springframework.org/schema/beans/spring-beans.xsd
						http://www.springframework.org/schema/util 		http://www.springframework.org/schema/util/spring-util.xsd
						http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd
						http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.0.xsd ">
    

<import resource="spring-mqseries-sender-re-try.xml" />

    <!-- JNDI Environment Template -->
    <bean id="jndiMQTemplate" class="org.springframework.jndi.JndiTemplate">
        <property name="environment">
            <props>
                <prop key="java.naming.factory.initial">com.sun.jndi.fscontext.RefFSContextFactory</prop>
                <prop key="java.naming.provider.url">file:/C:/JNDI-Directory</prop>
            </props>
        </property>
    </bean>

    <!-- JMS Queue Connection Factory -->
    <bean id="internalJmsQueueConnectionFactory"
        class="org.springframework.jndi.JndiObjectFactoryBean">
        <property name="jndiTemplate">
            <ref bean="jndiMQTemplate"/>
        </property>
        <property name="jndiName" value="JNDI2TestConnectionFactory">
        </property>
    </bean>

    <!-- Spring JMS Queue Connection Factory -->
    <bean id="jmsQueueConnectionFactory"
        class="org.springframework.jms.connection.SingleConnectionFactory">
        <property name="targetConnectionFactory">
            <ref bean="internalJmsQueueConnectionFactory"/>
        </property>
    </bean>

   
<bean id="MQdestination"
	    class="org.springframework.jndi.JndiObjectFactoryBean">
	    <property name="jndiTemplate">
	        <ref bean="jndiMQTemplate"/>
	    </property>
	    <property name="jndiName" value="JNDI2Queue">
	        
	    </property>
	</bean>

    <!-- JMS Queue Template -->
    <bean id="jmsQueueTemplate" class="org.springframework.jms.core.JmsTemplate">
        <property name="connectionFactory">
            <ref bean="connectionQueueFactory"/>
        </property>
        <property name="defaultDestination">
            <ref bean="MQdestination"/>
        </property>
        <property name="pubSubDomain">
            <value>false</value>
        </property>
        <property name="receiveTimeout">
            <value>20000</value>
        </property>
    </bean>
    
     <bean id="jmsSender" class="com.capgemini.mq.JMSMQSender">
      <property name="jmsTemplate102">
            <ref bean="jmsQueueTemplate"/>
        </property>
     
      </bean>
    
      <bean id="jmsReceiver" class="com.capgemini.mq.JMSMQReceiver">
      <property name="jmsTemplate102">
            <ref bean="jmsQueueTemplate"/>
        </property>
     
      </bean>
      <!-- Use a cache for connectionfactory -->
	<!-- <bean id="cachingConnectionFactory"
		class="org.springframework.jms.connection.CachingConnectionFactory">
		<property name="targetConnectionFactory" ref="internalJmsQueueConnectionFactory" />

	</bean> -->
	 <bean id="connectionQueueFactory" class="org.springframework.jms.connection.TransactionAwareConnectionFactoryProxy">
        <property name="targetConnectionFactory" ref="jmsQueueConnectionFactory"/>
        <property name="synchedLocalTransactionAllowed" value="true"/>
    </bean>
	<bean id="transactionManagerMQ" class="org.springframework.jms.connection.JmsTransactionManager">
        <property name="connectionFactory" ref="connectionQueueFactory" />
    </bean>
      <!-- <bean
		class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="connectionQueueFactory" />
		<property name="destination" ref="MQdestination" />
		<property name="messageListener" ref="messageListener" />
        <property name="sessionTransacted" value="true" />
        <property name="transactionManager" ref="transactionManagerMQ" />
        <property name="concurrentConsumers" value="1" />
        <property name="recoveryInterval" value="600000000" />
		<property name="exceptionListener" ref="exceptionListener" />
	</bean>

	<bean id="messageListener" class="com.capgemini.mq.JMSMQMessageListener">
	</bean> -->
      
</beans>