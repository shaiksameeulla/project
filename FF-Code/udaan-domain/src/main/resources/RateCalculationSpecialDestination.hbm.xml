<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>


	
	<class name="com.ff.domain.ratemanagement.operations.ratequotation.RateCalculationSpecialDestDO"  table="ff_f_rate_quotation_special_destination">
		<id name="rateQuotationSpecialDestinationId" type="java.lang.Integer" column="RATE_QUOTATION_SPECIAL_DESTINATION_ID">
			<generator class="native" />
		</id>
		
		<!--  <property name="pinCode">
        	<column name="RATE_QUOTATION_PINCODE"/>
		</property> -->
		
		<property name="rate" type="java.lang.Double">
        	<column name="RATE"/>
		</property>
		
		<property name="order" type="java.lang.Integer">
        	<column name="DESTINATION_ORDER"/>
		</property>
		
		<property name="originSector">
        	<column name="RATE_QUOTATION_ORIGIN_SECTOR"/>
		</property>
		
		<property name="cityId" column="RATE_QUOTATION_SPECIAL_DESTINATION_CITY"/>
		
		<property name="stateId" column="STATE_ID"/>
		
		<many-to-one name="rateQuotationWeightSlabDO" class="com.ff.domain.ratemanagement.operations.ratequotation.RateCalculationWeightSlabDO"  lazy="false"  fetch="join">
		<column name="RATE_QUOTATION_WEIGHT_SLAB" />
		</many-to-one>
		
		<property name="rateQuotationProductCategoryHeader" column="RATE_QUOTATION_PRODUCT_CATEGORY_HEADER"/>
		<property name="rateCalculatedFor" column="RATE_CONFIGURED_FOR_TYPE"/> 
    </class>
   
   	<query name="getSpecialDestinationSlabs">
		<![CDATA[
				  SELECT sd
			      FROM 	com.ff.domain.ratemanagement.operations.ratequotation.RateCalculationSpecialDestDO sd
			      INNER JOIN sd.rateQuotationWeightSlabDO weightSlabDO
				  WHERE sd.stateId=:state
				  AND ((sd.cityId=:cityId) OR (sd.cityId IS NULL AND 0 = (SELECT COUNT(*) FROM com.ff.domain.ratemanagement.operations.ratequotation.RateCalculationSpecialDestDO sd1
				  														  WHERE sd1.stateId=:state 
				  														  AND sd1.cityId=:cityId 
				  														  AND sd1.rateQuotationProductCategoryHeader =:rateQuotationProductCategoryHeaderId
				  														  AND (((:originConsidered = 'N') AND (sd1.originSector IS NULL))
                               													 OR ((:originConsidered = 'Y') AND  (sd1.originSector =:originSector)))
				  														  )
				  								))
				  AND (((:originConsidered = 'N') AND (sd.originSector IS NULL))
                                OR ((:originConsidered = 'Y') AND  (sd.originSector =:originSector)))
                  AND ((sd.rateCalculatedFor IS NULL) OR (sd.rateCalculatedFor =:rateCalculatedFor) OR (sd.rateCalculatedFor ='B'))
				  AND sd.rateQuotationProductCategoryHeader =:rateQuotationProductCategoryHeaderId
				  ORDER BY weightSlabDO.order
		]]>
	</query>

</hibernate-mapping>