<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<class name="com.ff.domain.routeserviced.TripDO" table="ff_f_trip">
		<id name="tripId" type="java.lang.Integer" column="TRIP_ID">
			<generator class="native" />
		</id>
				
        <property name="arrivalTime" type="java.lang.String" column="ARRIVAL_TIME"/>
        <property name="departureTime" type="java.lang.String" column="DEPARTURE_TIME"/>
        <property name="active" type="java.lang.String" column="ACTIVE"/>
        
        <property name="dtToBranch" column="DT_TO_BRANCH"/>
        <property name="dtToCentral" column="DT_TO_CENTRAL"/>
        <property name="dtFromOpsman" column="DT_FROM_OPSMAN"/>
        <property name="dtUpdateToCentral" column="DT_UPDATE_TO_CENTRAL"/>
        
		<many-to-one name="transportDO" class="com.ff.domain.transport.TransportDO" lazy="false" fetch="join" cascade="all">
			<column name="TRANSPORT" />
		</many-to-one>
		 				
		<many-to-one name="routeDO" class="com.ff.domain.routeserviced.RouteDO" lazy="false" fetch="join" cascade="all">
			<column name="ROUTE"/>
		</many-to-one>
		 				
		<!-- <many-to-one name="originPortDO" class="com.ff.domain.transport.PortDO" lazy="false" fetch="join" cascade="all">
			<column name="ORIGIN_PORT" />
		</many-to-one>
		 				
		<many-to-one name="destPortDO" class="com.ff.domain.transport.PortDO" lazy="false" fetch="join" cascade="all">
			<column name="DESTINATION_PORT" />
		</many-to-one>	 -->
	</class>
	
	<query name="getTripDetailsByRouteAndTransportMode">
	<![CDATA[ FROM com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN (SELECT route.routeId FROM  com.ff.domain.routeserviced.RouteDO route where route.originCityDO.cityId=:originCity
	 		  AND route.destCityDO.cityId=:destCity) AND trip.transportDO.transportId IN (SELECT transport.transportId from com.ff.domain.transport.TransportDO transport where transport.transportModeDO.transportModeId=:transportMode)]]>
	</query>


	<query name="getTripDetailsByVendorTripServicedBy">
	<![CDATA[ FROM com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN 
	 		  (SELECT route.routeId FROM  com.ff.domain.routeserviced.RouteDO route 
	 		  	where route.originCityDO.cityId=:originCity AND route.destCityDO.cityId=:destCity)
	 		  AND trip.transportDO.transportId IN 
	 		  	(SELECT transport.transportId from com.ff.domain.transport.TransportDO transport where
	 		  	 transport.transportModeDO.transportModeId=:transportMode)
	 		  AND ((trip.tripId NOT IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom <=:effectiveTo and tsby.effectiveTo >=:effectiveFrom
	 		  AND tsby.tripDO.routeDO.originCityDO.cityId=:originCity AND tsby.tripDO.routeDO.destCityDO.cityId=:destCity
	 		  AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId
	 		  AND tsby.servicedByDO.loadMovementVendorDO.vendorId =:vendorId))
	 		  OR (trip.tripId IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom =:effectiveFrom and tsby.effectiveTo =:effectiveTo
	 		  AND tsby.tripDO.routeDO.originCityDO.cityId=:originCity AND tsby.tripDO.routeDO.destCityDO.cityId=:destCity
	 		  AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId
	 		  AND tsby.servicedByDO.loadMovementVendorDO.vendorId =:vendorId)))
	 		  AND trip.active =:active	 		  	 		  
	 		  ]]>
	</query>
	
	
	<!-- <query name="getTripDetailsByEmployeeTripServicedBy">
	<![CDATA[ FROM com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN 
	 		  (SELECT route.routeId FROM  com.ff.domain.routeserviced.RouteDO route 
	 		  	where route.originCityDO.cityId=:originCity AND route.destCityDO.cityId=:destCity)
	 		  AND trip.transportDO.transportId IN 
	 		  	(SELECT transport.transportId from com.ff.domain.transport.TransportDO transport where
	 		  	 transport.transportModeDO.transportModeId=:transportMode)
	 		  AND ((trip.tripId NOT IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom <=:effectiveTo and tsby.effectiveTo >=:effectiveFrom
	 		  AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId
	 		  AND tsby.servicedByDO.employeeDO.employeeId =:employeeId))
	 		  OR (trip.tripId IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom =:effectiveFrom and tsby.effectiveTo =:effectiveTo
	 		  AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId
	 		  AND tsby.servicedByDO.employeeDO.employeeId =:employeeId)))
	 		  AND trip.active =:active	 		  	 		  
	 		  ]]>
	</query>
 -->
 <query name="getTripDetailsByEmployeeTripServicedBy">
	<![CDATA[ FROM com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN 
	 		  (SELECT route.routeId FROM  com.ff.domain.routeserviced.RouteDO route 
	 		  	where route.originCityDO.cityId=:originCity AND route.destCityDO.cityId=:destCity)
	 		  AND trip.transportDO.transportId IN 
	 		  	(SELECT transport.transportId from com.ff.domain.transport.TransportDO transport where
	 		  	 transport.transportModeDO.transportModeId=:transportMode)
	 		  AND ((trip.tripId NOT IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom <=:effectiveTo and tsby.effectiveTo >=:effectiveFrom
	 		  AND tsby.tripDO.routeDO.originCityDO.cityId=:originCity AND tsby.tripDO.routeDO.destCityDO.cityId=:destCity
	 		   AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId))
	 		  OR (trip.tripId IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom =:effectiveFrom and tsby.effectiveTo =:effectiveTo
	 		  AND tsby.tripDO.routeDO.originCityDO.cityId=:originCity AND tsby.tripDO.routeDO.destCityDO.cityId=:destCity
	 		   AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId)))
	 		  AND trip.active =:active	 		  	 		  
	 		  ]]>
	</query>
	<query name="inActiveTripDetails">
		<![CDATA[
 			update com.ff.domain.routeserviced.TripDO trip
 			set trip.active =:active
 			where trip.tripId in (:tripId)
		]]>
	</query>
	
	<!-- Data Sync For Route Serviced By Module  Start -->
		
	<query name="getUnsyncInboundTrip">
		<![CDATA[From com.ff.domain.routeserviced.TripDO trip
					where trip.dtToCentral='N' 
					or trip.dtToCentral is null 
		]]>
	</query>
	<query name="getUnsyncOutboundTrip">
		<![CDATA[From com.ff.domain.routeserviced.TripDO trip
					where trip.dtToBranch='N'
		]]>
	</query>
	
	<query name="getTripIdByRouteTransportModeFlight">
	<![CDATA[ SELECT trip.tripId FROM 
				com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN (:routeId)
	 		  AND trip.arrivalTime=:arrivalTime
	 		  AND trip.departureTime=:departureTime
	 		  AND trip.transportDO.transportId IN
	 		  	(SELECT transport.transportId from com.ff.domain.transport.TransportDO transport 
	 		  		where transport.transportModeDO.transportModeId=:transportModeId
	 		  		AND transport.flightDO.flightId=:flightId
	 		  	)
	 		]]>
	</query>
			
	<query name="getTripIdByRouteTransportModeTrain">
	<![CDATA[ SELECT trip.tripId FROM 
				com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN (:routeId)
	 		  AND trip.arrivalTime=:arrivalTime
	 		  AND trip.departureTime=:departureTime
	 		  AND trip.transportDO.transportId IN
	 		  	(SELECT transport.transportId from com.ff.domain.transport.TransportDO transport 
	 		  		where transport.transportModeDO.transportModeId=:transportModeId
	 		  		AND transport.trainDO.trainId=:trainId
	 		  	)
	 		]]>
	</query>
			
	<query name="getTripIdByRouteTransportModeVehicle">
	<![CDATA[ SELECT trip.tripId FROM 
				com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN (:routeId)
	 		  AND trip.arrivalTime=:arrivalTime
	 		  AND trip.departureTime=:departureTime
	 		  AND trip.transportDO.transportId IN
	 		  	(SELECT transport.transportId from com.ff.domain.transport.TransportDO transport 
	 		  		where transport.transportModeDO.transportModeId=:transportModeId
	 		  		AND transport.vehicleDO.vehicleId=:vehicleId
	 		  	)
	 		]]>
	</query>

	<query name="getTripIdsByRouteAndTransportMode">
	<![CDATA[ SELECT trip.tripId FROM com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN (SELECT route.routeId FROM  com.ff.domain.routeserviced.RouteDO route where route.originCityDO.cityId=:originCity
	 		  AND route.destCityDO.cityId=:destCity) 
	 		  AND trip.transportDO.transportId IN 
	 		  (SELECT transport.transportId from com.ff.domain.transport.TransportDO transport where transport.transportModeDO.transportModeId=:transportMode)
	 		  AND  trip.active ='Y']]>
	</query>
	
	<query name="getTripDetailsByRegionForVehicle">
	<![CDATA[ FROM com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.active ='Y' AND trip.routeDO.routeId IN (SELECT route.routeId FROM  com.ff.domain.routeserviced.RouteDO route where route.originCityDO.cityId=:originCity
	 		  AND route.destCityDO.cityId=:destCity) AND trip.transportDO.transportId IN (
	 		  SELECT transport.transportId from com.ff.domain.transport.TransportDO transport where transport.transportModeDO.transportModeId=:transportMode
	 		  AND transport.vehicleDO.regionalOfficeDO.officeId IN (select office.officeId FROM com.ff.domain.organization.OfficeDO office
					WHERE office.officeTypeDO.offcTypeCode=:officeTypeCode and  office.mappedRegionDO.regionId=:regionId))
	 		  
	 		  ]]>
	</query>
	<!-- Data Sync For Route Serviced By Module End -->
	
	<query name="getTripIdsForVehicleByRegion">
	<![CDATA[ SELECT trip.tripId FROM com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN (SELECT route.routeId FROM  com.ff.domain.routeserviced.RouteDO route where route.originCityDO.cityId=:originCity
	 		  AND route.destCityDO.cityId=:destCity) 
	 		  AND trip.transportDO.transportId IN 
	 		  (SELECT transport.transportId from com.ff.domain.transport.TransportDO transport where transport.transportModeDO.transportModeId=:transportMode
	 		  AND transport.vehicleDO.regionalOfficeDO.officeId IN (select office.officeId FROM com.ff.domain.organization.OfficeDO office
					WHERE office.officeTypeDO.offcTypeCode=:officeTypeCode and  office.mappedRegionDO.regionId=:regionId))
	 		  AND  trip.active ='Y'
	 		  ]]>
	</query>
	
	<query name="getTripDetailsByEmployeeTripServicedByForVehicle">
	<![CDATA[ FROM com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN 
	 		  (SELECT route.routeId FROM  com.ff.domain.routeserviced.RouteDO route 
	 		  	where route.originCityDO.cityId=:originCity AND route.destCityDO.cityId=:destCity)
	 		  AND trip.transportDO.transportId IN 
	 		  	(SELECT transport.transportId from com.ff.domain.transport.TransportDO transport where
	 		  	 transport.transportModeDO.transportModeId=:transportMode
	 		  	AND transport.vehicleDO.regionalOfficeDO.officeId IN (select office.officeId FROM com.ff.domain.organization.OfficeDO office
					WHERE office.officeTypeDO.offcTypeCode=:officeTypeCode and  office.mappedRegionDO.regionId=:regionId))
	 		  AND ((trip.tripId NOT IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom <=:effectiveTo and tsby.effectiveTo >=:effectiveFrom
	 		  AND tsby.tripDO.routeDO.originCityDO.cityId=:originCity AND tsby.tripDO.routeDO.destCityDO.cityId=:destCity
	 		   AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId))
	 		  OR (trip.tripId IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom =:effectiveFrom and tsby.effectiveTo =:effectiveTo
	 		  AND tsby.tripDO.routeDO.originCityDO.cityId=:originCity AND tsby.tripDO.routeDO.destCityDO.cityId=:destCity
	 		   AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId)))
	 		  AND trip.active =:active	 		  	 		  
	 		  ]]>
	</query>
	
	<query name="getTripDetailsByVendorTripServicedByForVehicle">
	<![CDATA[ FROM com.ff.domain.routeserviced.TripDO trip
	 		  WHERE trip.routeDO.routeId IN 
	 		  (SELECT route.routeId FROM  com.ff.domain.routeserviced.RouteDO route 
	 		  	where route.originCityDO.cityId=:originCity AND route.destCityDO.cityId=:destCity)
	 		  AND trip.transportDO.transportId IN 
	 		  	(SELECT transport.transportId from com.ff.domain.transport.TransportDO transport where
	 		  	 transport.transportModeDO.transportModeId=:transportMode
	 		  	 AND transport.vehicleDO.regionalOfficeDO.officeId IN (select office.officeId FROM com.ff.domain.organization.OfficeDO office
					WHERE office.officeTypeDO.offcTypeCode=:officeTypeCode and  office.mappedRegionDO.regionId=:regionId))
	 		  AND ((trip.tripId NOT IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom <=:effectiveTo and tsby.effectiveTo >=:effectiveFrom
	 		  AND tsby.tripDO.routeDO.originCityDO.cityId=:originCity AND tsby.tripDO.routeDO.destCityDO.cityId=:destCity
	 		  AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId
	 		  AND tsby.servicedByDO.loadMovementVendorDO.vendorId =:vendorId))
	 		  OR (trip.tripId IN (SELECT tsby.tripDO.tripId from com.ff.domain.routeserviced.TripServicedByDO tsby 
	 		  where tsby.effectiveFrom =:effectiveFrom and tsby.effectiveTo =:effectiveTo
	 		  AND tsby.tripDO.routeDO.originCityDO.cityId=:originCity AND tsby.tripDO.routeDO.destCityDO.cityId=:destCity
	 		  AND tsby.servicedByDO.serviceByTypeDO.serviceByTypeId =:serviceByTypeId
	 		  AND tsby.servicedByDO.loadMovementVendorDO.vendorId =:vendorId)))
	 		  AND trip.active =:active	 		  	 		  
	 		  ]]>
	</query>
</hibernate-mapping>