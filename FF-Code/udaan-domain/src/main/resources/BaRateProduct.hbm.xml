<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
	<class name="com.ff.domain.ratemanagement.operations.ba.BaRateProductDO" table="ff_f_rate_ba_product_header">
		<id name="baProductHeaderId">
			<column name="RATE_BA_PRODUCT_HEADER_ID" />
			<generator class="native" />
		</id>
		<!-- <property name="rateProductCategory">
            <column name="RATE_PRODUCT_CATEGORY" />
         </property> -->
         
         <many-to-one name="rateProductCategory" class="com.ff.domain.ratemanagement.masters.RateProductCategoryDO"  lazy="false" >
			<column name="RATE_PRODUCT_CATEGORY" />
		</many-to-one> 
		 
		 <many-to-one name="baRateHeaderDO" class="com.ff.domain.ratemanagement.operations.ba.BaRateHeaderDO" fetch="select"  lazy="false">
           <column name="RATE_BA_HEADER"/>
        </many-to-one> 
        <property name="dtToBranch" column="DT_TO_BRANCH" />
	</class>
	<query name="getBARateProductHeader">
		<![CDATA[ 
		    SELECT prodHeader
			FROM  com.ff.domain.ratemanagement.operations.ba.BaRateProductDO prodHeader 
			INNER JOIN prodHeader.baRateHeaderDO headerDO
			INNER JOIN headerDO.customerTypeDO custType
			WHERE custType.customerTypeId IN ( SELECT cType.customerTypeId
									   		 FROM   com.ff.domain.business.CustomerDO  cust
									   		 INNER JOIN cust.customerType cType
							 		   		 WHERE  cust.customerCode=:baCustomerCode )
			AND   headerDO.cityId=(	SELECT c.cityId FROM com.ff.domain.geography.CityDO c 
									WHERE c.cityCode=:cityCode)
			AND   (:currentDate >= headerDO.fromDate) 
			AND   headerDO.headerStatus = 'A'
			AND   prodHeader.rateProductCategory.rateProductCategoryId IN (	SELECT 	rateProductCategoryId 
														FROM 	com.ff.domain.ratemanagement.masters.RateProductProductCategoryMapDO 
														WHERE	productId = ( SELECT productId from com.ff.domain.serviceOffering.ProductDO
																		  	  WHERE productCode =:productCode)
											  	    )
			ORDER BY headerDO.fromDate DESC	
		]]>
	</query>
	
	<query name="isProductValidForBACustomerContract">
		<![CDATA[ 
			SELECT prodheader.rateProductCategory.rateProductCategoryId
			FROM  com.ff.domain.ratemanagement.operations.ba.BaRateProductDO prodheader 
			INNER JOIN prodheader.baRateHeaderDO header
			WHERE header.customerTypeDO.customerTypeId  IN( 	SELECT cust.customerType.customerTypeId
														  		FROM   com.ff.domain.business.CustomerDO  cust
														  		WHERE  cust.customerCode=:baCustomerCode
														  		AND 	cust.status = 'A')
			AND   header.cityId=( SELECT c.cityId 
								  FROM com.ff.domain.geography.CityDO c 
								  WHERE c.cityCode=:cityCode )
			AND   (:currentDate >= header.fromDate) 
			AND   prodheader.rateProductCategory.rateProductCategoryId IN (SELECT 	rateProductCategoryId 
													 FROM 	com.ff.domain.ratemanagement.masters.RateProductProductCategoryMapDO 
													 WHERE	productId IN (  SELECT 	pct.productDO.productId 
 																			FROM 	com.ff.domain.ratemanagement.masters.ProductCustomerTypeMapDO pct
 																			WHERE	pct.customerTypeDO.customerTypeId = header.customerTypeDO.customerTypeId
 																			AND		pct.productDO.productCode =:productCode
																	    )
											            )
			AND  header.headerStatus = 'A'	
			 
		]]>
	</query>
	
</hibernate-mapping>
	